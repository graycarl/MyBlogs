<!DOCTYPE html>
<html lang="zh">
<head>
        <title>Windows下gVim使用python3的智能提示 - I am HHB</title>
        <meta charset="utf-8" />

        <!-- UIKIT -->
        <link href="http://cdn.bootcss.com/uikit/2.0.0/css/uikit.min.css" rel="stylesheet">
        <script src="http://cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>
        <script src="http://cdn.bootcss.com/uikit/2.0.0/js/uikit.min.js"></script>
        <!-- MyCSS -->
        <link rel="stylesheet/less" type="text/css" href="/theme/css/hhb-uikit.less">
        <link rel="stylesheet/less" type="text/css" href="/theme/css/code.css">
        <script src="http://cdn.bootcss.com/less.js/1.6.0/less.min.js"></script>
        <link href="http://fonts.googleapis.com/css?family=Nova+Script|Racing+Sans+One" rel="stylesheet" type="text/css">
        <!-- FEEDS -->
</head>

<body>
    <header class="hhb-banner">
        <hgroup>
            <h1 class="uk-heading-large"><a href="/">I am HHB</a></h1>
            <p>月亮哪去了</p>
        </hgroup>
    </header>
    <nav class="uk-navbar hhb-navbar">
        <ul class="uk-navbar-nav">
            <li class="uk-active"><a href="/category/articles.html">Articles</a></li>
            <li><a href="/category/life.html">Life</a></li>
            <li><a href="/category/notes.html">Notes</a></li>
        </ul>
        <!--
        <div class="uk-navbar-content uk-navbar-flip">
            <form class="uk-form uk-margin-remove uk-display-inline-block" action="">
                <input type="text" placeholder="Search" />
            </form>
        </div>
        -->
    </nav>

    <div class="hhb-content">
<article class="uk-article">
    <header>
        <h1 class="uk-article-title">
            <a class="hidden" href="/vim-python3-autocomplete-on-windows.html" rel="bookmark"
                title="Permalink to Windows下gVim使用python3的智能提示">Windows下gVim使用python3的智能提示</a>
        </h1>
        <p class="uk-article-meta">Hongbo He · <abbr title="2012-09-17T00:58:00+08:00">2012-09-17 00:58</abbr></p>
        
    </header>
    <div class="entry-content">
        <p>之前一直以为windows下的gvim是不支持python的只能提示(<code>Ctrl-x Ctrl-o</code>)的，因为每次执行都会被提示需要在编译时加上<code>+python</code>。今天又上网搜了下该问题，发现貌似并不是这个问题。</p>
<p>在gvim中执行<code>:version</code>输出如下</p>
<div class="highlight"><pre><span></span>VIM - Vi IMproved 7.3 (2010 Aug 15, compiled Oct 27 2010 17:59:02)
MS-Windows 32 位图形界面版本 带 OLE 支持
包含补丁: 1-46
编译者 Bram@KIBAALE
大型版本 带图形界面。  可使用(+)与不可使用(-)的功能:
+arabic +autocmd +balloon_eval +browse ++builtin_terms +byte_offset +cindent
+clientserver +clipboard +cmdline_compl +cmdline_hist +cmdline_info +comments
+conceal +cryptv +cscope +cursorbind +cursorshape +dialog_con_gui +diff
+digraphs -dnd -ebcdic +emacs_tags +eval +ex_extra +extra_search +farsi
+file_in_path +find_in_path +float +folding -footer +gettext/dyn -hangul_input
+iconv/dyn +insert_expand +jumplist +keymap +langmap +libcall +linebreak
+lispindent +listcmds +localmap -lua +menu +mksession +modify_fname +mouse
+mouseshape +multi_byte_ime/dyn +multi_lang -mzscheme +netbeans_intg +ole
-osfiletype +path_extra +perl/dyn +persistent_undo -postscript +printer
-profile +python/dyn +python3/dyn +quickfix +reltime +rightleft +ruby/dyn
+scrollbind +signs +smartindent -sniff +startuptime +statusline -sun_workshop
+syntax +tag_binary +tag_old_static -tag_any_white +tcl/dyn -tgetent
-termresponse +textobjects +title +toolbar +user_commands +vertsplit
+virtualedit +visual +visualextra +viminfo +vreplace +wildignore +wildmenu
+windows +writebackup -xfontset -xim -xterm_save +xpm_w32
......
</pre></div>


<p>里面有<code>+python/dyn +python3/dyn</code>，说明其本身是支持python的。但是在gvim中执行<code>:echo has("python")</code>的时候返回为零，并且<code>:py &lt;code&gt;</code>也没法执行。</p>
<p>在网上搜索的时候发现有人提到了gvim和python的安装顺序。我看了下，发现我是先安装了gvim-windows再安装了python3-windows的，觉得有可能是这个问题。于是把gvim卸了重新安装，再执行<code>:echo has("python")</code>还是返回零。</p>
<p>又想到是不是由于我安装的是python3？于是就试了下<code>:echo has("python3")</code>，果然这次返回了1，<code>:py3 &lt;code&gt;</code>也是正常的。所以这里我也不确定是不是和安装顺序有关，因为之前从来没有试过<code>:py3</code>。</p>
<p>重新打开一个python代码，用<code>Ctrl-x Ctrl-o</code>发现还是不行，一样的提示</p>
<div class="highlight"><pre><span></span><span class="n">Error</span><span class="o">:</span> <span class="n">Required</span> <span class="n">vim</span> <span class="n">compiled</span> <span class="k">with</span> <span class="o">+</span><span class="n">python</span>
<span class="n">E117</span><span class="o">:</span> <span class="n">Unknown</span> <span class="kd">function</span><span class="o">:</span> <span class="n">pythoncomplete</span><span class="err">#</span><span class="n">Complete</span>
</pre></div>


<p>不过有了以上的经历我猜到应该是vim还是去找python2了，问题可能是<code>pythoncomplete#Complete</code>这里。在gvim安装目录里面搜了一下<code>python</code>，发现有<code>pythoncomplete.vim</code>这个包和<code>python3complete.vim</code>这个包。所以应该是文件类型处理里面指定了使用<code>pythoncomplete</code>而不是<code>python3complete</code>。</p>
<p>打开gvim目录里面的ftplugin/python.vim，果然找到了</p>
<div class="highlight"><pre><span></span>setlocal omnifunc=pythoncomplete#Complete
</pre></div>


<p>改成</p>
<div class="highlight"><pre><span></span>setlocal omnifunc=python3complete#Complete
</pre></div>


<p>这样就可以正常使用了。</p>
    </div>
</section>
    </div>
    <hr/>
    <footer>
    <p>
    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>.
    </p>
    </footer>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

</body>
</html>